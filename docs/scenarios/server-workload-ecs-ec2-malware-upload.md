# Scenario: Vision One XDR for Containers Detect Malware Upload

***DRAFT***

## Optional: Retrieve Tenant ID and Token from Server & Workload Protection

You might want to know the tenant ID and token from your Server & Workload Protection to continue using deployment scripts we know from Deep/Workload Security.

To get them navigate to your instance in Vision One. Then head over to `Administration --> Updates --> Software --> Local --> Generate Deployment Scripts...`

Either copy the full script or find the tenant ID and token on the very bottom of the script.

If you save these values to the Playground One configuration with `pgo -c` the EC2 instances of the ECS (EC2) cluster will get an agent deployed.

### Section: Vision One

Vision One Server & Workload Protection does support the deployment script functionality from Cloud One Workload Security. The ECS EC2 cluster can optionally deploy the agent using this mechanism. To enable this

Set/update:

- `Server & Workload Protection tenant ID`: The tenant ID to use. If the tenant ID is omitted the Server & Workload Protection configuration will be skipped.
- `Server & Workload Protection token`: The token to use
- `Server & Workload Protection policy ID`: The policy to assign


## Prerequisites

- Vision One XDR for Containers linked with Playground One VPC
- Playground One ECS Cluster with EC2 instances
    - Running app: Java-Goof running on vulnerable Tomcat
- Server & Workload Protection configuration set for
    - Tenant ID
    - Token
    - Policy ID of policy with Anti Malware protection enabled

Eventually set/update the Server & Workload Protection configuration

```sh
pgo --config
```

Ensure to have an ECS Cluster up and running:

```sh
pgo --apply ecs
```

## Disclaimer

> ***Note:*** It is highly recommended to have the `awsone.access_ip` set to a single IP or at least a small CIDR before deploying the ECS cluster. This will prevent anonymous users playing with your environmnent. Remember: we're using vulnerable apps.

## Exploiting

First, retrieve the load balancer DNS name

```sh
pgo -o ecs
```

Example output with ECS EC2:

```sh
cluster_name_ec2 = "playground-ecs-ec2"
loadbalancer_dns_ec2 = "playground-ecs-ec2-135067951.eu-central-1.elb.amazonaws.com"
```

### Exploit

To access the `todolist` application append `/todolist` to the loadbalancer DNS name in your browser.

Navigate to <http://playground-ecs-ec2-135067951.eu-central-1.elb.amazonaws.com/todolist>

Click `[Sign in]`

- Username: `foo@bar.org`
- Password: `foobar`

Then navigate to `Upload files` and upload some malware.

View events in Server & Workload Protection
