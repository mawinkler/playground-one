#!/usr/bin/env bash

PGO_VERSION=latest
PORT=2222

rm -f get_pgoc.sh

printf '%s\n' "Ensuring Playground One Container is up to date"
docker pull mawinkler/pgoc:${PGO_VERSION}

if [ ! "$(docker ps -q -f name=pgoc-${PGO_VERSION})" ]; then
  printf '%s\n' "Starting Playground One Container"
  docker run \
    --rm \
    --detach \
    --name=pgoc-${PGO_VERSION} \
    --env TZ=Europe/Berlin \
    --env DEBIAN_FRONTEND=noninteractive \
    --publish ${PORT}:22 \
    --volume $(pwd)/workdir:/home/pgo \
    --volume /var/run/docker.sock:/var/run/docker.sock \
    mawinkler/pgoc:${PGO_VERSION}

  sleep 2
fi

printf '\n%s\n' "Connect:  ssh -p ${PORT} pgo@localhost"
printf '%s\n' "Password: pgo"

ssh -o StrictHostKeyChecking=no -p ${PORT} pgo@localhost
